<html>

<head>
	<!-- Mobile 화면 : Viewport 설정 -->
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<meta name="viewport"
		content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
	<meta name="robots" content="noindex">
	<meta name="format-detection" content="telephone=no">
	<!--STEP 1: CSS 추가하기 -->
	<!--CDN 방식 -->
	<!--<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"/>-->
	<!-- Download 방식 -->
	<link rel="stylesheet" href="css/leaflet@1.3.3/leaflet.css" />
	<!--STEP 3: 지도 영역 관련 CSS 추가하기 -->
	<link rel="stylesheet" href="css/main.css" />
	<!--STEP 2: JS 추가하기 -->
	<!--CDN 방식 -->
	<!--<script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>-->
	<!-- Download 방식 -->
	<script src="js/leaflet@1.3.3/leaflet.js"></script>
	<!-- Leaflet Plugins: Leaflet.KoreanTmsProviders 추가  -->
	<script src="js/KoreanTmsProviders/lib/proj4.js"></script>
	<script src="js/KoreanTmsProviders/lib/proj4leaflet.js"></script>
	<script src="js/KoreanTmsProviders/src/Leaflet.KoreanTmsProviders.js"></script>
</head>

<body>
	<!-- 배경지도 영역 추가하기-->
	<div id="map" class="map"></div>
	<script>
		var map = new L.Map('map', {
			center: new L.LatLng(35.871645, 128.601494), //중심점 : 김천 위경도 좌표
			zoom: 12,	//Leaflet.KoreanTmsProviders.js : resolutions기준 줌 레벨(Level 12)
			crs: L.Proj.CRS.Daum, //Leaflet.KoreanTmsProviders.js : 새로 정의된 Daum Map CRS
			worldCopyJump: false,  //https://leafletjs.com/reference-1.3.2.html#map-worldcopyjump 참조    
		});
		var baseLayers = L.tileLayer.koreaProvider('DaumMap.Street').addTo(map);


		//-------------------------------------
		// 중심좌표 마커 생성  (대구광역시청)
		//-------------------------------------
		//마커생성
		var marker1 = L.marker([35.871410, 128.601800]).addTo(map);
		marker1.bindPopup("대구광역시청").openPopup(); // 팝업 표시

		// 커스텀 이미지 
		var customIcon = L.icon({
			iconUrl: './marker-image2.png',			//  아이콘 경로 
			iconSize: [48, 48],		//	아이콘 크기[가로,세로]
			iconAnchor: [25, 0],	// 	마커 기준점(하단 중앙)
			pipupAnchor: [0, 0]	//	팝업 위치 조정
		})
		// 커스텀 마커
		var customMarker = L.marker([35.872410, 128.601800], { icon: customIcon }).addTo(map);

		// 팝업창 설정
		customMarker.bindPopup(`<div style='width:150px;height:20px'>HOVER POPUP TEST</div>`);

		// Hover이벤트시  처리
		customMarker.on('mouseover', (e) => {
			customMarker.openPopup()
		})
		customMarker.on('mouseout', (e) => {
			customMarker.closePopup();
		})

		// 마커 클릭 이벤트 처리
		customMarker.on('click', (e) => {
			console.log('clicked..', e)
		})

		//우클릭 마우스 이동
		// 상태 변수
		let isFollowing = false;
		// 마우스 움직일 때 따라다니는 로직
		function onMouseMove(e) {
			if (isFollowing) {
				customMarker.setLatLng(e.latlng);
			}

		}

		// 마커 우클릭 이벤트 등록
		customMarker.on('contextmenu', function (e) {
			if (!isFollowing) {
				// 마커가 마우스를 따라다니게 설정
				isFollowing = true;
				map.on('mousemove', onMouseMove);
				customMarker.setOpacity(0.5);  // 희미하게
				customMarker.closePopup();
			} else {
				// 마커 고정 및 위도/경도 표시
				isFollowing = false;
				map.off('mousemove', onMouseMove);
				customMarker.setLatLng(e.latlng);
				customMarker.setOpacity(1);  // 원래 상태로

				const lat = e.latlng.lat.toFixed(6);
				const lng = e.latlng.lng.toFixed(6);
				customMarker.setPopupContent(`
				<div style='width:180px;'>
					<strong>현재 위치</strong><br>
					위도: ${lat}<br>
					경도: ${lng}
				</div>
			`);
				customMarker.openPopup();
			}
		});

		

	</script>
</body>

</html>